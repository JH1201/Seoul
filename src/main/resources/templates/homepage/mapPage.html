<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ì„œìš¸ì€ ì§€ê¸ˆ</title>
    <meta charset="UTF-8">
    <style>
        @font-face {
            font-family: 'TTHakgyoansimMulgyeolB';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2402_keris@1.0/TTHakgyoansimMulgyeolB.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }
        @font-face {
            font-family: 'SokchoBadaBatang';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2402_1@1.0/SokchoBadaBatang.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        h1 {
            font-family: 'TTHakgyoansimMulgyeolB';
            text-align: center;
            font-size: 80px;
            position: relative;
            bottom: 40px;
        }

        body {
            font-family: 'SokchoBadaBatang';
        }

        .dateSearch {
            display: flex;
            flex-basis: 50%;
            justify-content: center;
        }


        #date1 {
            padding: 10px;
            border:2px solid darkgray;
            border-radius: 10px;
            height: 30px;
            font-size: 12px;
            color: darkgray;
            font-family: 'SokchoBadaBatang';
        }

        #date2 {
            padding: 10px;
            border:2px solid darkgray;
            border-radius: 10px;
            height: 30px;
            font-size: 12px;
            color: darkgray;
            font-family: 'SokchoBadaBatang';
        }

        .search-container {
            margin-top: 2%;
            display: flex;
            justify-content: center;
            flex-direction: column;
            position: relative;
            bottom: 60px;
        }

        .searchUpPart {
            display: flex;
            justify-content: space-between;
            width: 100%;
            align-items: center;
        }


        .date {
            font-size: 16px;
            padding: 2px;
        }

        .search-part {
            flex-basis: 50%;
            justify-content: center;
            position: relative;
            display: inline-block;
            margin-bottom: 5px;
            margin-right: 20px;
        }

        .search-bar {
            padding: 10px;
            font-size: 12px;
            height: 30px;
            border-radius:10px;
            border: 2px solid darkgray;
            font-family: 'SokchoBadaBatang';
        }

        .search-button {
            width: 20%;
            height:30px; /* ë²„íŠ¼ì˜ ë†’ì´ ì¡°ì ˆ */
            font-size: 20px;
            color: darkgray;
            cursor: pointer;
            position: absolute;
            right: 8px;
            bottom:13px;
            background-color: rgba(0, 0, 0, 0);
            border: none;
        }

        .searchDownPart {
            display: flex;
            justify-content: flex-start;
            padding-left: 1%;
            flex-direction: column;
        }

        .eventType input[type="checkbox"],
        .locationName input[type="checkbox"] {
            display: none;
        }

        .eventType label,
        .locationName label {
            cursor: pointer; /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ í¬ì¸í„°ë¡œ ë³€ê²½ */
            font-size: 12px;
            background-color: rgba(220, 220, 220, 0.9);
            border-radius: 30px;
            padding: 5px;
        }

        .eventType, .locationName {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        /* ì„ íƒëœ ì²´í¬ë°•ìŠ¤ì— ëŒ€í•œ ë¼ë²¨ ìŠ¤íƒ€ì¼ì„ ë³€ê²½í•©ë‹ˆë‹¤. */
        input[type="checkbox"]:checked + label {
            font-weight: bold;
            font-size: 15px;
            background-color: rgba(200, 200, 200, 0.9);
            border-radius: 20px;
            padding: 5px;
        }

        .detailButton {
            text-align: center;
        }

        .detailButton button {
            padding: 5px;
            border-radius: 20px;
            cursor: pointer;
            border: 0;
            font-family: 'SokchoBadaBatang';
            font-size: 15px;
            font-weight: bold;
            margin-right: 5px;
            margin-left: 5px;
            background-color: rgba(220, 220, 220, 0.8);
        }

        .item {
            display: flex;
            align-items: center;
        }

        img {
            width: 80px;
            height: 120px;"
        }

        /* ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì„¤ì • */
        #container {
            display: flex;
            height: 100vh;
        }
        /* ì„¸ë¶€ ì •ë³´ ì„¹ì…˜ ìŠ¤íƒ€ì¼ ì„¤ì • */
        #details {
            flex: 1; /* í™”ë©´ì˜ 1/4 ì°¨ì§€ */
            overflow-y: auto; /* ë‚´ìš©ì´ ë†’ì´ë¥¼ ì´ˆê³¼í•˜ë©´ ìŠ¤í¬ë¡¤ë°” í‘œì‹œ */
            max-height: 100vh; /* ë·°í¬íŠ¸ ë†’ì´ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ */
        }
        /* ì§€ë„ ì„¹ì…˜ ìŠ¤íƒ€ì¼ ì„¤ì • */
        #map {
            flex: 3; /* í™”ë©´ì˜ 3/4 ì°¨ì§€ */
            height: 100%; /* ì§€ë„ ë†’ì´ ì„¤ì • */
        }

    </style>
</head>
<body>


<div id="container">
    <div id="details">
        <h1>
            <a href="/home" style="text-decoration: none">ì„œìš¸ì€ ì§€ê¸ˆ</a>
        </h1>

        <div class="search-container">
            <div class="searchUpPart">
                <div class="dateSearch">
                    <div class="date">
                        <label for="date1">
                            <input type="date" id="date1"></input>
                        </label>
                    </div>
                    <div class="date" style="display: flex; align-items: center; height: 60px;"> ~ </div>
                    <div class="date">
                        <label for="date2">
                            <input type="date" id="date2" value="2024-12-31"></input>
                        </label>
                    </div>
                </div>

                <div>
                    <form class="search-part" id="searchForm" action="/search" method="get">
                        <input type="text" name="keyword" class="search-bar" placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ex: í–‰ì‚¬ëª…, ì¥ì†Œ, ì—­ ë“±)" >
                        <button class="search-button" type="submit">ğŸ”ï¸</button>
                    </form>
                </div>
            </div>
            <br><br>
            <div class="searchDownPart">
                <div class="eventType">
                    <input type="checkbox" id="select0" name="codename" value="ì „ì²´"><label for="select0" id="select0Label"> ì „ì²´</label>
                    <input type="checkbox" id="select1" name="codename" value="ë®¤ì§€ì»¬/ì˜¤í˜ë¼"><label for="select1" id="select1Label"> ë®¤ì§€ì»¬/ì˜¤í˜ë¼</label>
                    <input type="checkbox" id="select2" name="codename" value="ì—°ê·¹"><label for="select2" id="select2Label"> ì—°ê·¹</label>
                    <input type="checkbox" id="select3" name="codename" value="ë¬´ìš©"><label for="select3" id="select3Label"> ë¬´ìš©</label>
                    <input type="checkbox" id="select4" name="codename" value="êµ­ì•…"><label for="select4" id="select4Label"> êµ­ì•…</label>
                    <input type="checkbox" id="select5" name="codename" value="í´ë˜ì‹"><label for="select5" id="select5Label"> í´ë˜ì‹</label>
                    <input type="checkbox" id="select6" name="codename" value="ì „ì‹œ/ë¯¸ìˆ "><label for="select6" id="select6Label"> ì „ì‹œ/ë¯¸ìˆ </label>
                    <input type="checkbox" id="select7" name="codename" value="êµìœ¡/ì²´í—˜"><label for="select7" id="select7Label"> êµìœ¡/ì²´í—˜</label>
                    <input type="checkbox" id="select8" name="codename" value="ì½˜ì„œíŠ¸"><label for="select8" id="select8Label"> ì½˜ì„œíŠ¸</label>
                    <input type="checkbox" id="select9" name="codename" value="ì˜í™”"><label for="select9" id="select9Label"> ì˜í™”</label>
                    <input type="checkbox" id="select10" name="codename" value="ë…ì£¼/ë…ì°½íšŒ"><label for="select10" id="select10Label"> ë…ì£¼/ë…ì°½íšŒ</label>
                    <input type="checkbox" id="select11" name="codename" value="ì¶•ì œ"><label for="select11" id="select11Label"> ì¶•ì œ</label>
                    <input type="checkbox" id="select12" name="codename" value="ê¸°íƒ€"><label for="select12" id="select12Label"> ê¸°íƒ€</label>
                </div><br><br>

                <div class="locationName">
                    <input type="checkbox" id="location0" name="codename" value="ì „ì²´"><label for="location0" id="location0Label"> ì „ì²´</label>
                    <input type="checkbox" id="location1" name="codename" value="ê°•ë‚¨êµ¬"><label for="location1" id="location1Label"> ê°•ë‚¨êµ¬</label>
                    <input type="checkbox" id="location2" name="codename" value="ê°•ë™êµ¬"><label for="location2" id="location2Label"> ê°•ë™êµ¬</label>
                    <input type="checkbox" id="location3" name="codename" value="ê°•ë¶êµ¬"><label for="location3" id="location3Label"> ê°•ë¶êµ¬</label>
                    <input type="checkbox" id="location4" name="codename" value="ê°•ì„œêµ¬"><label for="location4" id="location4Label"> ê°•ì„œêµ¬</label>
                    <input type="checkbox" id="location5" name="codename" value="ê´€ì•…êµ¬"><label for="location5" id="location5Label"> ê´€ì•…êµ¬</label>
                    <input type="checkbox" id="location6" name="codename" value="ê´‘ì§„êµ¬"><label for="location6" id="location6Label"> ê´‘ì§„êµ¬</label>
                    <input type="checkbox" id="location7" name="codename" value="êµ¬ë¡œêµ¬"><label for="location7" id="location7Label"> êµ¬ë¡œêµ¬</label>
                    <input type="checkbox" id="location8" name="codename" value="ê¸ˆì²œêµ¬"><label for="location8" id="location8Label"> ê¸ˆì²œêµ¬</label>
                    <input type="checkbox" id="location9" name="codename" value="ë…¸ì›êµ¬"><label for="location9" id="location9Label"> ë…¸ì›êµ¬</label>
                    <input type="checkbox" id="location10" name="codename" value="ë„ë´‰êµ¬"><label for="location10" id="location10Label"> ë„ë´‰êµ¬</label>
                    <input type="checkbox" id="location11" name="codename" value="ë™ëŒ€ë¬¸êµ¬"><label for="location11" id="location11Label"> ë™ëŒ€ë¬¸êµ¬</label>
                    <input type="checkbox" id="location12" name="codename" value="ë™ì‘êµ¬"><label for="location12" id="location12Label"> ë™ì‘êµ¬</label>
                    <input type="checkbox" id="location13" name="codename" value="ë§ˆí¬êµ¬"><label for="location13" id="location13Label"> ë§ˆí¬êµ¬</label>
                    <input type="checkbox" id="location14" name="codename" value="ì„œëŒ€ë¬¸êµ¬"><label for="location14" id="location14Label"> ì„œëŒ€ë¬¸êµ¬</label>
                    <input type="checkbox" id="location15" name="codename" value="ì„œì´ˆêµ¬"><label for="location15" id="location15Label"> ì„œì´ˆêµ¬</label>
                    <input type="checkbox" id="location16" name="codename" value="ì„±ë™êµ¬"><label for="location16" id="location16Label"> ì„±ë™êµ¬</label>
                    <input type="checkbox" id="location17" name="codename" value="ì„±ë¶êµ¬"><label for="location17" id="location17Label"> ì„±ë¶êµ¬</label>
                    <input type="checkbox" id="location18" name="codename" value="ì†¡íŒŒêµ¬"><label for="location18" id="location18Label"> ì†¡íŒŒêµ¬</label>
                    <input type="checkbox" id="location19" name="codename" value="ì–‘ì²œêµ¬"><label for="location19" id="location19Label"> ì–‘ì²œêµ¬</label>
                    <input type="checkbox" id="location20" name="codename" value="ì˜ë“±í¬êµ¬"><label for="location20" id="location20Label"> ì˜ë“±í¬êµ¬</label>
                    <input type="checkbox" id="location21" name="codename" value="ìš©ì‚°êµ¬"><label for="location21" id="location21Label"> ìš©ì‚°êµ¬</label>
                    <input type="checkbox" id="location22" name="codename" value="ì€í‰êµ¬"><label for="location22" id="location22Label"> ì€í‰êµ¬</label>
                    <input type="checkbox" id="location23" name="codename" value="ì¢…ë¡œêµ¬"><label for="location23" id="location23Label"> ì¢…ë¡œêµ¬</label>
                    <input type="checkbox" id="location24" name="codename" value="ì¤‘êµ¬"><label for="location24" id="location24Label"> ì¤‘êµ¬</label>
                    <input type="checkbox" id="location25" name="codename" value="ì¤‘ë‘êµ¬"><label for="location25" id="location25Label"> ì¤‘ë‘êµ¬</label>

                    <!--<select id="location" onchange="sort()">
                        <option value="ì¢…ë¡œêµ¬" th:selected="${selectedMonth == 'ì¢…ë¡œêµ¬'}">ì¢…ë¡œêµ¬</option>
                        <option value="ì¦ê²¨ì°¾ê¸°" th:selected="${selectedMonth == 'ì¦ê²¨ì°¾ê¸°'}">ì¦ê²¨ì°¾ê¸°</option>
                        <option value="ê°•ë‚¨êµ¬" th:selected="${selectedMonth == 'ê°•ë‚¨êµ¬'}">ê°•ë‚¨êµ¬</option>
                        <option value="ê°•ì„œêµ¬" th:selected="${selectedMonth == 'ê°•ì„œêµ¬'}">ê°•ì„œêµ¬</option>
                        <option value="ì¤‘êµ¬" th:selected="${selectedMonth == 'ì¤‘êµ¬'}">ì¤‘êµ¬</option>
                        <option value="ë§ˆí¬êµ¬" th:selected="${selectedMonth == 'ë§ˆí¬êµ¬'}">ë§ˆí¬êµ¬</option>
                        <option value="ì€í‰êµ¬" th:selected="${selectedMonth == 'ì€í‰êµ¬'}">ì€í‰êµ¬</option>

                    </select>-->

                    <script>
                        function sort() {
                            var selectedOption = document.getElementById('sortOptions').value;
                            // ì„œë²„ë¡œ GET ìš”ì²­ ë³´ë‚´ê¸°
                            fetch(`/getí•¨ìˆ˜ì´ë¦„?ì§€ì—­=${location}`)
                                .then(response => response.text())
                                .then(html => {
                                    // í˜ì´ì§€ì˜ ì¼ë¶€ë¥¼ ì„œë²„ì˜ ì‘ë‹µìœ¼ë¡œ ì—…ë°ì´íŠ¸
                                    document.getElementById('content').innerHTML = html;
                                })
                                .catch(error => console.error('Error:', error));
                        }
                    </script>
                </div><br><br>
                <div class="detailButton">
                    <button id="detailSearch"> ê²€ìƒ‰í•˜ê¸° </button>
                    <button id="resetButton"> ì„ íƒ ì´ˆê¸°í™” </button>
                </div>
            </div>
            <script>
                // í˜„ì¬ ë‚ ì§œë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
                function getCurrentDate() {
                    const today = new Date();
                    const year = today.getFullYear();
                    let month = today.getMonth() + 1;
                    let day = today.getDate();

                    // ì›”ê³¼ ì¼ì´ í•œ ìë¦¬ ìˆ«ìì¸ ê²½ìš° ì•ì— 0ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.
                    if (month < 10) {
                        month = '0' + month;
                    }
                    if (day < 10) {
                        day = '0' + day;
                    }

                    return `${year}-${month}-${day}`;
                }

                // input ìš”ì†Œì˜ value ì†ì„±ì— í˜„ì¬ ë‚ ì§œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
                document.getElementById('date1').value = getCurrentDate();
            </script>

        </div>

        <h3>ì§€ë„ì— ìˆëŠ” í–‰ì‚¬ë“¤ì˜ ë¦¬ìŠ¤íŠ¸</h3>
        <div id="eventsContainer">
        <div class="items-grid">
            <div th:each="event : ${lists}" class="item">
                <a th:href="@{/eventInfo(title=${event.getTITLE()})}">
                    <img th:src="${event.getMAIN_IMG()}" alt="Event Image">
                </a>
                <div>
                    <h4 th:text="${event.getTITLE()}"></h4>
                    <p class="is-free" th:text="${event.getIS_FREE()}"></p>
                </div>
            </div>

            <div th:if="${lists == null || lists.isEmpty()}">
            <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // eventTypeê³¼ locationName ì„¹ì…˜ì˜ ëª¨ë“  ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬
                document.querySelectorAll('.eventType input[type="checkbox"], .locationName input[type="checkbox"]').forEach(function(checkbox) {
                    checkbox.addEventListener('change', function() {
                        const parentDiv = this.closest('div'); // í˜„ì¬ ì²´í¬ë°•ìŠ¤ì˜ ë¶€ëª¨ div
                        const allCheckbox = parentDiv.querySelector('input[type="checkbox"][value="ì „ì²´"]'); // í˜„ì¬ ì„¹ì…˜ì˜ 'ì „ì²´' ì²´í¬ë°•ìŠ¤

                        if (this.value === "ì „ì²´") {
                            // 'ì „ì²´' ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒëœ ê²½ìš°, ë‹¤ë¥¸ ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
                            if (this.checked) {
                                parentDiv.querySelectorAll('input[type="checkbox"]:not([value="ì „ì²´"])').forEach(cb => cb.checked = false);
                            }
                        } else {
                            // 'ì „ì²´'ê°€ ì•„ë‹Œ ì²´í¬ë°•ìŠ¤ ì„ íƒ ì‹œ 'ì „ì²´' ì²´í¬ë°•ìŠ¤ í•´ì œ
                            allCheckbox.checked = false;

                            // ë‹¤ë¥¸ ì²´í¬ë°•ìŠ¤ê°€ í•˜ë‚˜ë¼ë„ ì„ íƒëœ ê²½ìš° 'ì „ì²´' ì²´í¬ë°•ìŠ¤ ìœ ì§€ë¥¼ í•´ì œ
                            const anyChecked = Array.from(parentDiv.querySelectorAll('input[type="checkbox"]:not([value="ì „ì²´"])')).some(cb => cb.checked);
                            if (!anyChecked) {
                                // ëª¨ë“  ì²´í¬ë°•ìŠ¤ê°€ í•´ì œë˜ë©´ 'ì „ì²´' ì²´í¬ë°•ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì„ íƒí•˜ì§€ ì•ŠìŒ
                                allCheckbox.checked = false;
                            }
                        }
                    });
                });

                // 'ì„ íƒ ì´ˆê¸°í™”' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                document.getElementById('resetButton').addEventListener('click', function() {
                    document.querySelectorAll('.searchDownPart input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
                });

                document.getElementById('detailSearch').addEventListener('click', function(event) {
                    event.preventDefault();
                    var eventTypes = Array.from(document.querySelectorAll('.eventType input[type="checkbox"]:checked')).map(checkbox => checkbox.value).join(",");
                    var locations = Array.from(document.querySelectorAll('.locationName input[type="checkbox"]:checked')).map(checkbox => checkbox.value).join(",");
                    var keyword = document.querySelector('.search-bar').value.trim(); // í‚¤ì›Œë“œ ê²€ìƒ‰ì–´
                    var startDate = document.getElementById('date1').value; // ì‹œì‘ ë‚ ì§œ
                    var endDate = document.getElementById('date2').value; // ì¢…ë£Œ ë‚ ì§œ

                    fetch(`/searchEvents?keyword=${encodeURIComponent(keyword)}&startDate=${startDate}&endDate=${endDate}&eventTypes=${eventTypes}&locations=${locations}`, {
                        headers: {
                            'Accept': 'application/json'
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            updatePageWithFilteredEvents(data); // ê²€ìƒ‰ ê²°ê³¼ë¡œ UI ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
                        })
                        .catch(error => console.error('Error:', error));
                });
            });
        </script>

    </div>
    <div id="map"></div>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=33db73c119b1dea112b5e9038fd6ef2a"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script th:inline="javascript">
        // ì¹´ì¹´ì˜¤ë§µ API ì´ˆê¸°í™”
        var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div
            mapOption = {
                center: new kakao.maps.LatLng(37.566535, 126.9779692), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                level: 7 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
            };
        var map = new kakao.maps.Map(mapContainer, mapOption);
        // ì§€ë„ì— í™•ëŒ€ ì¶•ì†Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
        var zoomControl = new kakao.maps.ZoomControl();
        // ì§€ë„ì˜ ìš°ì¸¡ì— í™•ëŒ€ ì¶•ì†Œ ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•©ë‹ˆë‹¤
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
        var  cultureInfoList = [[${lists}]]; // í–‰ì‚¬ ì •ë³´ ë¦¬ìŠ¤íŠ¸
        var markersInfo = [];
        var markers = [];
        addMarkersToMap(map, cultureInfoList);

        function addMarkersToMap(map, cultureInfoList) {
            removeMarkers();
            markersInfo = cultureInfoList;
            // í˜„ì¬ ì§€ë„ì˜ ê²½ê³„ë¥¼ ê°€ì ¸ì˜´
            var bounds = map.getBounds();
            var southWest = bounds.getSouthWest(); // ë‚¨ì„œìª½ ì¢Œí‘œ
            var northEast = bounds.getNorthEast(); // ë¶ë™ìª½ ì¢Œí‘œ

            console.log(southWest);
            console.log(northEast);


            cultureInfoList.forEach(function(cultureInfo) {
                var lat = parseFloat(cultureInfo.lat);
                var lng = parseFloat(cultureInfo.lot); // ì˜¤íƒ€ ìˆ˜ì • 'lot' -> 'lng'

                var position = new kakao.maps.LatLng(lng, lat);

                var marker = new kakao.maps.Marker({
                    map: map,
                    position: position
                });
                // ìƒˆë¡œìš´ ë§ˆì»¤ë¥¼ ë°°ì—´ì— ì¶”ê°€
                markers.push(marker);
            });
        }

        function addMarkersToMap2(map, cultureInfoList) {
            removeMarkers(); // ê¸°ì¡´ ë§ˆì»¤ ì‚­ì œ
            markersInfo = cultureInfoList;

            // cultureInfoListê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            if (!cultureInfoList || cultureInfoList.length === 0) {
                // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œì™€ í™•ëŒ€ ë ˆë²¨ ì„¤ì •
                map.setCenter(new kakao.maps.LatLng(37.566535, 126.9779692));
                map.setLevel(7);
                return; // í•¨ìˆ˜ ì¢…ë£Œ
            }

            // í˜„ì¬ ì§€ë„ì˜ ê²½ê³„ë¥¼ ê°€ì ¸ì˜´
            var bounds = new kakao.maps.LatLngBounds();

            cultureInfoList.forEach(function(cultureInfo) {
                var lat = parseFloat(cultureInfo.lat);
                var lng = parseFloat(cultureInfo.lot);

                var position = new kakao.maps.LatLng(lng, lat);
                bounds.extend(position);

                var marker = new kakao.maps.Marker({
                    map: map,
                    position: position
                });
                // ìƒˆë¡œìš´ ë§ˆì»¤ë¥¼ ë°°ì—´ì— ì¶”ê°€
                markers.push(marker);
            });

            map.setBounds(bounds);
        }


        function removeMarkers() {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = []; // ë§ˆì»¤ ë°°ì—´ ì´ˆê¸°í™”
        }

            // ì§€ë„ì˜ ì´ë™ì´ ëë‚  ë•Œë§ˆë‹¤ ë§ˆì»¤ë¥¼ ì—…ë°ì´íŠ¸
            kakao.maps.event.addListener(map, 'idle', function() {
                console.log('idle ì´ë²¤íŠ¸ ë°œìƒ');
                //addMarkersToMap(map, cultureInfoList);
                // í˜„ì¬ ì§€ë„ì˜ ê²½ê³„ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
                var bounds = map.getBounds();
                var southWest = bounds.getSouthWest();
                var northEast = bounds.getNorthEast();


                // Ajax ìš”ì²­ì„ ë³´ë‚´ëŠ” ë¶€ë¶„
                $.ajax({
                    url: '/filterEvents',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        markersInfo: markersInfo,
                        bounds: {
                            southWestLat: bounds.getSouthWest().getLat(),
                            southWestLng: bounds.getSouthWest().getLng(),
                            northEastLat: bounds.getNorthEast().getLat(),
                            northEastLng: bounds.getNorthEast().getLng()
                        }
                    }),
                    success: function(filteredEvents) {
                        console.log("success")

                        // í•„í„°ë§ëœ í–‰ì‚¬ ë°ì´í„°ë¡œ í˜ì´ì§€ì˜ ë‚´ìš©ì„ ì—…ë°ì´íŠ¸
                        updatePageWithFilteredEvents(filteredEvents);
                    },
                    error: function(error) {
                        console.error('Error fetching filtered events:', error);
                    }
                });

        });

        function updatePageWithFilteredEvents(events) {
            // í–‰ì‚¬ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ í˜ì´ì§€ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‘ì„±í•©ë‹ˆë‹¤.
            // ì˜ˆë¥¼ ë“¤ì–´, Thymeleaf ëŒ€ì‹  ìˆœìˆ˜ JavaScriptë¡œ DOMì„ ì¡°ì‘í•˜ì—¬
            // í–‰ì‚¬ ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

            // ì›¹ í˜ì´ì§€ì— í–‰ì‚¬ë¥¼ í‘œì‹œí•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•©ë‹ˆë‹¤.
            const eventsContainer = document.getElementById('eventsContainer');
            eventsContainer.innerHTML = ''; // ê¸°ì¡´ì˜ í–‰ì‚¬ ëª©ë¡ì„ ë¹„ì›ë‹ˆë‹¤.


            // ë°›ì€ í–‰ì‚¬ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ìƒˆë¡œìš´ ëª©ë¡ ì•„ì´í…œì„ ìƒì„±í•©ë‹ˆë‹¤.
            events.forEach(event => {

                var item = document.createElement('div');
                item.classList.add('item');

                var imageLink = document.createElement('a');
                imageLink.href = `/eventInfo?title=${encodeURIComponent(event.title)}`;

                var image = document.createElement('img');
                image.src = event.main_IMG;
                image.alt = 'Event Image';

                var title = document.createElement('h4');
                title.innerText = event.title;

                var isFree = document.createElement('p');
                isFree.innerText = event.isFree ? 'ë¬´ë£Œ' : 'ìœ ë£Œ';
                isFree.classList.add('is-free');

                var imageContainer = document.createElement('div');
                imageLink.appendChild(image);
                imageContainer.appendChild(imageLink);

                var titleContainer = document.createElement('div');
                titleContainer.appendChild(title);
                titleContainer.appendChild(isFree);

                // eventsContainerì— ìƒˆë¡œìš´ í–‰ì‚¬ ì•„ì´í…œì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                item.appendChild(imageContainer);
                item.appendChild(titleContainer);
                eventsContainer.appendChild(item);
            });

            // ì´ë²¤íŠ¸ê°€ ì—†ì„ ë•Œ í‘œì‹œí•  ë©”ì‹œì§€ì…ë‹ˆë‹¤.
            if (events.length === 0) {
                var noEventsMsg = document.createElement('p');
                noEventsMsg.innerText = 'ì§„í–‰ì¤‘ì¸ í–‰ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.';
                document.getElementById('eventsContainer').appendChild(noEventsMsg);
            }

        }

    </script>


    <script>
        function updateEventsContainer(data) {
            // eventsContainer ì—…ë°ì´íŠ¸
            var eventsContainer = document.getElementById('eventsContainer');

            // ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ëŠ” ë¶€ë¶„ ì—…ë°ì´íŠ¸
            var itemsGrid = document.createElement('div');
            itemsGrid.classList.add('items-grid');

            if (data && data.length > 0) {
                data.forEach(event => {
                    var item = document.createElement('div');
                    item.classList.add('item');


                    var imageLink = document.createElement('a');
                    imageLink.href = `/eventInfo?title=${encodeURIComponent(event.title)}`;

                    var image = document.createElement('img');
                    image.src = event.main_IMG;
                    image.alt = 'Event Image';
                    image.width = 150;
                    image.height = 170;

                    var title = document.createElement('span');
                    title.innerText = event.title;

                    var isFree = document.createElement('p');
                    isFree.innerText = event.isFree ? 'ë¬´ë£Œ' : 'ìœ ë£Œ';
                    isFree.classList.add('is-free');

                    var imageContainer = document.createElement('div');
                    imageLink.appendChild(image);
                    imageContainer.appendChild(imageLink);

                    var titleContainer = document.createElement('div');
                    titleContainer.appendChild(title);
                    titleContainer.appendChild(isFree);

                    item.appendChild(imageContainer);
                    item.appendChild(titleContainer);
                    itemsGrid.appendChild(item);
                });
            } else {
                var noResultMessage = document.createElement('p');
                noResultMessage.innerText = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
                eventsContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°
                eventsContainer.appendChild(noResultMessage);
                return;
            }

            eventsContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°
            eventsContainer.appendChild(itemsGrid);
        }

    </script>
    <script>
        document.getElementById('searchForm').addEventListener('submit', function (event) {
            event.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë°©ì§€

            var keyword = document.querySelector('.search-bar').value.trim();

            // ì„œë²„ë¡œ GET ìš”ì²­ ë³´ë‚´ê¸°
            fetch(`/search?keyword=${encodeURIComponent(keyword)}`)
                .then(response => response.json()) // JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ ë°›ê¸°
                .then(data => {
                    // ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°›ì•„ì„œ UI ì—…ë°ì´íŠ¸
                    updateEventsContainer(data);
                    addMarkersToMap2(map, data);
                })
                .catch(error => console.error('Error:', error));
        });
    </script>
</div>


</body>
</html>

